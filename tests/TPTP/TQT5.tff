% ==============================================================================
% BIDIRECTIONAL DATE ARITHMETIC - Forward AND Backward
% Authors: Adam Pease & Pante Stanica, and a lot of coffee
% ==============================================================================

% --- Type Definitions ---
tff(dayFn_tp,type, dayFn: ($int * $i) > $i ).
tff(monthFn_tp,type, monthFn: ($i * $i) > $i ).
tff(yearFn_tp,type, yearFn: ($int) > $i ).
tff(addDayFn_tp,type, addDayFn: ($int * $i) > $i ).
tff(daysInMonth_tp,type, daysInMonth: ($int * $i) > $o).

% --- ALL Month Type Declarations ---
tff(jan_tp,type, january: $i).
tff(feb_tp,type, february: $i).
tff(mar_tp,type, march: $i).
tff(apr_tp,type, april: $i).
tff(may_tp,type, may: $i).
tff(jun_tp,type, june: $i).
tff(jul_tp,type, july: $i).
tff(aug_tp,type, august: $i).
tff(sep_tp,type, september: $i).
tff(oct_tp,type, october: $i).
tff(nov_tp,type, november: $i).
tff(dec_tp,type, december: $i).

% --- ALL Day Counts ---
tff(janDays,axiom, daysInMonth(31,january)).
tff(febDays,axiom, daysInMonth(28,february)).
tff(marDays,axiom, daysInMonth(31,march)).
tff(aprDays,axiom, daysInMonth(30,april)).
tff(mayDays,axiom, daysInMonth(31,may)).
tff(junDays,axiom, daysInMonth(30,june)).
tff(julDays,axiom, daysInMonth(31,july)).
tff(augDays,axiom, daysInMonth(31,august)).
tff(sepDays,axiom, daysInMonth(30,september)).
tff(octDays,axiom, daysInMonth(31,october)).
tff(novDays,axiom, daysInMonth(30,november)).
tff(decDays,axiom, daysInMonth(31,december)).

% ==============================================================================
% FORWARD OPERATIONS - Adding Days
% ==============================================================================

% BASE CASE: Within same month (forward)
tff(sameMonth_fwd,axiom,
  ![D1:$int, D2:$int, DM:$int, M:$i, Y:$int]:(
    ( daysInMonth(DM, M) &
      $lesseq($sum(D1, D2), DM) &
      $greater(D1, 0) &
      $greater(D2, 0)
    ) => (
      addDayFn(D2, dayFn(D1, monthFn(M, yearFn(Y)))) =
      dayFn($sum(D1, D2), monthFn(M, yearFn(Y)))
    )
  )).

% SINGLE MONTH OVERFLOW (FORWARD) - 12 axioms
% December → January (YEAR TRANSITION)
tff(decToJan_fwd,axiom,
  ![D1:$int, D2:$int, Y:$int]:(
    ( $greater($sum(D1, D2), 31) &
      $lesseq($sum(D1, D2), 62) &
      $lesseq(D1, 31) &
      $greater(D1, 0) &
      $greater(D2, 0)
    ) => (
      addDayFn(D2, dayFn(D1, monthFn(december, yearFn(Y)))) =
      dayFn($difference($sum(D1, D2), 31), monthFn(january, yearFn($sum(Y, 1))))
    )
  )).

tff(janToFeb_fwd,axiom,
  ![D1:$int, D2:$int, Y:$int]:(
    ( $greater($sum(D1, D2), 31) &
      $lesseq($sum(D1, D2), 59) &
      $lesseq(D1, 31) &
      $greater(D1, 0) &
      $greater(D2, 0)
    ) => (
      addDayFn(D2, dayFn(D1, monthFn(january, yearFn(Y)))) =
      dayFn($difference($sum(D1, D2), 31), monthFn(february, yearFn(Y)))
    )
  )).

tff(febToMar_fwd,axiom,
  ![D1:$int, D2:$int, Y:$int]:(
    ( $greater($sum(D1, D2), 28) &
      $lesseq($sum(D1, D2), 59) &
      $lesseq(D1, 28) &
      $greater(D1, 0) &
      $greater(D2, 0)
    ) => (
      addDayFn(D2, dayFn(D1, monthFn(february, yearFn(Y)))) =
      dayFn($difference($sum(D1, D2), 28), monthFn(march, yearFn(Y)))
    )
  )).

tff(marToApr_fwd,axiom,
  ![D1:$int, D2:$int, Y:$int]:(
    ( $greater($sum(D1, D2), 31) &
      $lesseq($sum(D1, D2), 61) &
      $lesseq(D1, 31) &
      $greater(D1, 0) &
      $greater(D2, 0)
    ) => (
      addDayFn(D2, dayFn(D1, monthFn(march, yearFn(Y)))) =
      dayFn($difference($sum(D1, D2), 31), monthFn(april, yearFn(Y)))
    )
  )).

tff(aprToMay_fwd,axiom,
  ![D1:$int, D2:$int, Y:$int]:(
    ( $greater($sum(D1, D2), 30) &
      $lesseq($sum(D1, D2), 61) &
      $lesseq(D1, 30) &
      $greater(D1, 0) &
      $greater(D2, 0)
    ) => (
      addDayFn(D2, dayFn(D1, monthFn(april, yearFn(Y)))) =
      dayFn($difference($sum(D1, D2), 30), monthFn(may, yearFn(Y)))
    )
  )).

tff(mayToJun_fwd,axiom,
  ![D1:$int, D2:$int, Y:$int]:(
    ( $greater($sum(D1, D2), 31) &
      $lesseq($sum(D1, D2), 61) &
      $lesseq(D1, 31) &
      $greater(D1, 0) &
      $greater(D2, 0)
    ) => (
      addDayFn(D2, dayFn(D1, monthFn(may, yearFn(Y)))) =
      dayFn($difference($sum(D1, D2), 31), monthFn(june, yearFn(Y)))
    )
  )).

tff(junToJul_fwd,axiom,
  ![D1:$int, D2:$int, Y:$int]:(
    ( $greater($sum(D1, D2), 30) &
      $lesseq($sum(D1, D2), 61) &
      $lesseq(D1, 30) &
      $greater(D1, 0) &
      $greater(D2, 0)
    ) => (
      addDayFn(D2, dayFn(D1, monthFn(june, yearFn(Y)))) =
      dayFn($difference($sum(D1, D2), 30), monthFn(july, yearFn(Y)))
    )
  )).

tff(julToAug_fwd,axiom,
  ![D1:$int, D2:$int, Y:$int]:(
    ( $greater($sum(D1, D2), 31) &
      $lesseq($sum(D1, D2), 62) &
      $lesseq(D1, 31) &
      $greater(D1, 0) &
      $greater(D2, 0)
    ) => (
      addDayFn(D2, dayFn(D1, monthFn(july, yearFn(Y)))) =
      dayFn($difference($sum(D1, D2), 31), monthFn(august, yearFn(Y)))
    )
  )).

tff(augToSep_fwd,axiom,
  ![D1:$int, D2:$int, Y:$int]:(
    ( $greater($sum(D1, D2), 31) &
      $lesseq($sum(D1, D2), 61) &
      $lesseq(D1, 31) &
      $greater(D1, 0) &
      $greater(D2, 0)
    ) => (
      addDayFn(D2, dayFn(D1, monthFn(august, yearFn(Y)))) =
      dayFn($difference($sum(D1, D2), 31), monthFn(september, yearFn(Y)))
    )
  )).

tff(sepToOct_fwd,axiom,
  ![D1:$int, D2:$int, Y:$int]:(
    ( $greater($sum(D1, D2), 30) &
      $lesseq($sum(D1, D2), 61) &
      $lesseq(D1, 30) &
      $greater(D1, 0) &
      $greater(D2, 0)
    ) => (
      addDayFn(D2, dayFn(D1, monthFn(september, yearFn(Y)))) =
      dayFn($difference($sum(D1, D2), 30), monthFn(october, yearFn(Y)))
    )
  )).

tff(octToNov_fwd,axiom,
  ![D1:$int, D2:$int, Y:$int]:(
    ( $greater($sum(D1, D2), 31) &
      $lesseq($sum(D1, D2), 61) &
      $lesseq(D1, 31) &
      $greater(D1, 0) &
      $greater(D2, 0)
    ) => (
      addDayFn(D2, dayFn(D1, monthFn(october, yearFn(Y)))) =
      dayFn($difference($sum(D1, D2), 31), monthFn(november, yearFn(Y)))
    )
  )).

tff(novToDec_fwd,axiom,
  ![D1:$int, D2:$int, Y:$int]:(
    ( $greater($sum(D1, D2), 30) &
      $lesseq($sum(D1, D2), 61) &
      $lesseq(D1, 30) &
      $greater(D1, 0) &
      $greater(D2, 0)
    ) => (
      addDayFn(D2, dayFn(D1, monthFn(november, yearFn(Y)))) =
      dayFn($difference($sum(D1, D2), 30), monthFn(december, yearFn(Y)))
    )
  )).

% TWO MONTH OVERFLOW (FORWARD) - Key ones for 90-day tests
tff(decToFeb_fwd,axiom,
  ![D1:$int, D2:$int, Y:$int]:(
    ( $greater($sum(D1, D2), 62) &
      $lesseq($sum(D1, D2), 90) &
      $lesseq(D1, 31) &
      $greater(D1, 0) &
      $greater(D2, 0)
    ) => (
      addDayFn(D2, dayFn(D1, monthFn(december, yearFn(Y)))) =
      dayFn($difference($sum(D1, D2), 62), monthFn(february, yearFn($sum(Y, 1))))
    )
  )).

tff(janToMar_fwd,axiom,
  ![D1:$int, D2:$int, Y:$int]:(
    ( $greater($sum(D1, D2), 59) &
      $lesseq($sum(D1, D2), 90) &
      $lesseq(D1, 31) &
      $greater(D1, 0) &
      $greater(D2, 0)
    ) => (
      addDayFn(D2, dayFn(D1, monthFn(january, yearFn(Y)))) =
      dayFn($difference($sum(D1, D2), 59), monthFn(march, yearFn(Y)))
    )
  )).

% THREE MONTH OVERFLOW (FORWARD) - For 90-day tests
tff(decToMar_fwd,axiom,
  ![D1:$int, D2:$int, Y:$int]:(
    ( $greater($sum(D1, D2), 90) &
      $lesseq($sum(D1, D2), 121) &
      $lesseq(D1, 31) &
      $greater(D1, 0) &
      $greater(D2, 0)
    ) => (
      addDayFn(D2, dayFn(D1, monthFn(december, yearFn(Y)))) =
      dayFn($difference($sum(D1, D2), 90), monthFn(march, yearFn($sum(Y, 1))))
    )
  )).

% ==============================================================================
% BACKWARD OPERATIONS - Subtracting Days (Negative D2)
% ==============================================================================

% BASE CASE: Within same month (backward)
tff(sameMonth_bwd,axiom,
  ![D1:$int, D2:$int, DM:$int, M:$i, Y:$int]:(
    ( daysInMonth(DM, M) &
      $greatereq($sum(D1, D2), 1) &
      $lesseq(D1, DM) &
      $greater(D1, 0) &
      $less(D2, 0)
    ) => (
      addDayFn(D2, dayFn(D1, monthFn(M, yearFn(Y)))) =
      dayFn($sum(D1, D2), monthFn(M, yearFn(Y)))
    )
  )).

% SINGLE MONTH UNDERFLOW (BACKWARD) - 12 axioms
% January → December (YEAR TRANSITION BACKWARD)
tff(janToDec_bwd,axiom,
  ![D1:$int, D2:$int, Y:$int]:(
    ( $less($sum(D1, D2), 1) &
      $greatereq($sum(D1, D2), $uminus(30)) &
      $lesseq(D1, 31) &
      $greater(D1, 0) &
      $less(D2, 0)
    ) => (
      addDayFn(D2, dayFn(D1, monthFn(january, yearFn(Y)))) =
      dayFn($sum(30, $sum(D1, D2)), monthFn(december, yearFn($difference(Y, 1))))
    )
  )).

tff(febToJan_bwd,axiom,
  ![D1:$int, D2:$int, Y:$int]:(
    ( $less($sum(D1, D2), 1) &
      $greatereq($sum(D1, D2), $uminus(30)) &
      $lesseq(D1, 28) &
      $greater(D1, 0) &
      $less(D2, 0)
    ) => (
      addDayFn(D2, dayFn(D1, monthFn(february, yearFn(Y)))) =
      dayFn($sum(31, $sum(D1, D2)), monthFn(january, yearFn(Y)))
    )
  )).

tff(marToFeb_bwd,axiom,
  ![D1:$int, D2:$int, Y:$int]:(
    ( $less($sum(D1, D2), 1) &
      $greatereq($sum(D1, D2), $uminus(27)) &
      $lesseq(D1, 31) &
      $greater(D1, 0) &
      $less(D2, 0)
    ) => (
      addDayFn(D2, dayFn(D1, monthFn(march, yearFn(Y)))) =
      dayFn($sum(28, $sum(D1, D2)), monthFn(february, yearFn(Y)))
    )
  )).

tff(aprToMar_bwd,axiom,
  ![D1:$int, D2:$int, Y:$int]:(
    ( $less($sum(D1, D2), 1) &
      $greatereq($sum(D1, D2), $uminus(30)) &
      $lesseq(D1, 30) &
      $greater(D1, 0) &
      $less(D2, 0)
    ) => (
      addDayFn(D2, dayFn(D1, monthFn(april, yearFn(Y)))) =
      dayFn($sum(31, $sum(D1, D2)), monthFn(march, yearFn(Y)))
    )
  )).

tff(mayToApr_bwd,axiom,
  ![D1:$int, D2:$int, Y:$int]:(
    ( $less($sum(D1, D2), 1) &
      $greatereq($sum(D1, D2), $uminus(29)) &
      $lesseq(D1, 31) &
      $greater(D1, 0) &
      $less(D2, 0)
    ) => (
      addDayFn(D2, dayFn(D1, monthFn(may, yearFn(Y)))) =
      dayFn($sum(30, $sum(D1, D2)), monthFn(april, yearFn(Y)))
    )
  )).

tff(junToMay_bwd,axiom,
  ![D1:$int, D2:$int, Y:$int]:(
    ( $less($sum(D1, D2), 1) &
      $greatereq($sum(D1, D2), $uminus(30)) &
      $lesseq(D1, 30) &
      $greater(D1, 0) &
      $less(D2, 0)
    ) => (
      addDayFn(D2, dayFn(D1, monthFn(june, yearFn(Y)))) =
      dayFn($sum(31, $sum(D1, D2)), monthFn(may, yearFn(Y)))
    )
  )).

tff(julToJun_bwd,axiom,
  ![D1:$int, D2:$int, Y:$int]:(
    ( $less($sum(D1, D2), 1) &
      $greatereq($sum(D1, D2), $uminus(29)) &
      $lesseq(D1, 31) &
      $greater(D1, 0) &
      $less(D2, 0)
    ) => (
      addDayFn(D2, dayFn(D1, monthFn(july, yearFn(Y)))) =
      dayFn($sum(30, $sum(D1, D2)), monthFn(june, yearFn(Y)))
    )
  )).

tff(augToJul_bwd,axiom,
  ![D1:$int, D2:$int, Y:$int]:(
    ( $less($sum(D1, D2), 1) &
      $greatereq($sum(D1, D2), $uminus(30)) &
      $lesseq(D1, 31) &
      $greater(D1, 0) &
      $less(D2, 0)
    ) => (
      addDayFn(D2, dayFn(D1, monthFn(august, yearFn(Y)))) =
      dayFn($sum(31, $sum(D1, D2)), monthFn(july, yearFn(Y)))
    )
  )).

tff(sepToAug_bwd,axiom,
  ![D1:$int, D2:$int, Y:$int]:(
    ( $less($sum(D1, D2), 1) &
      $greatereq($sum(D1, D2), $uminus(30)) &
      $lesseq(D1, 30) &
      $greater(D1, 0) &
      $less(D2, 0)
    ) => (
      addDayFn(D2, dayFn(D1, monthFn(september, yearFn(Y)))) =
      dayFn($sum(31, $sum(D1, D2)), monthFn(august, yearFn(Y)))
    )
  )).

tff(octToSep_bwd,axiom,
  ![D1:$int, D2:$int, Y:$int]:(
    ( $less($sum(D1, D2), 1) &
      $greatereq($sum(D1, D2), $uminus(29)) &
      $lesseq(D1, 31) &
      $greater(D1, 0) &
      $less(D2, 0)
    ) => (
      addDayFn(D2, dayFn(D1, monthFn(october, yearFn(Y)))) =
      dayFn($sum(30, $sum(D1, D2)), monthFn(september, yearFn(Y)))
    )
  )).

tff(novToOct_bwd,axiom,
  ![D1:$int, D2:$int, Y:$int]:(
    ( $less($sum(D1, D2), 1) &
      $greatereq($sum(D1, D2), $uminus(30)) &
      $lesseq(D1, 30) &
      $greater(D1, 0) &
      $less(D2, 0)
    ) => (
      addDayFn(D2, dayFn(D1, monthFn(november, yearFn(Y)))) =
      dayFn($sum(31, $sum(D1, D2)), monthFn(october, yearFn(Y)))
    )
  )).

tff(decToNov_bwd,axiom,
  ![D1:$int, D2:$int, Y:$int]:(
    ( $less($sum(D1, D2), 1) &
      $greatereq($sum(D1, D2), $uminus(29)) &
      $lesseq(D1, 31) &
      $greater(D1, 0) &
      $less(D2, 0)
    ) => (
      addDayFn(D2, dayFn(D1, monthFn(december, yearFn(Y)))) =
      dayFn($sum(30, $sum(D1, D2)), monthFn(november, yearFn(Y)))
    )
  )).

% TWO MONTH UNDERFLOW (BACKWARD)
tff(marToJan_bwd,axiom,
  ![D1:$int, D2:$int, Y:$int]:(
    ( $less($sum(D1, D2), $uminus(27)) &
      $greatereq($sum(D1, D2), $uminus(58)) &
      $lesseq(D1, 31) &
      $greater(D1, 0) &
      $less(D2, 0)
    ) => (
      addDayFn(D2, dayFn(D1, monthFn(march, yearFn(Y)))) =
      dayFn($sum(59, $sum(D1, D2)), monthFn(january, yearFn(Y)))
    )
  )).

tff(febToDec_bwd,axiom,
  ![D1:$int, D2:$int, Y:$int]:(
    ( $less($sum(D1, D2), $uminus(30)) &
      $greatereq($sum(D1, D2), $uminus(61)) &
      $lesseq(D1, 28) &
      $greater(D1, 0) &
      $less(D2, 0)
    ) => (
      addDayFn(D2, dayFn(D1, monthFn(february, yearFn(Y)))) =
      dayFn($sum(62, $sum(D1, D2)), monthFn(december, yearFn($difference(Y, 1))))
    )
  )).

% THREE MONTH UNDERFLOW (BACKWARD) - For 90-day tests
tff(marToDec_bwd,axiom,
  ![D1:$int, D2:$int, Y:$int]:(
    ( $less($sum(D1, D2), $uminus(58)) &
      $greatereq($sum(D1, D2), $uminus(89)) &
      $lesseq(D1, 31) &
      $greater(D1, 0) &
      $less(D2, 0)
    ) => (
      addDayFn(D2, dayFn(D1, monthFn(march, yearFn(Y)))) =
      dayFn($sum(90, $sum(D1, D2)), monthFn(december, yearFn($difference(Y, 1))))
    )
  )).

% ==============================================================================
% TEST SUITE - Both Forward and Backward
% ==============================================================================

% FORWARD TESTS

% Test F1: 5 days forward within same month
% March 10 + 5 = March 15
%tff(test_fwd_same_month,conjecture,
%  ?[D:$int,M:$i,Y:$int]:(
%    dayFn(D,monthFn(M,yearFn(Y))) =
%      addDayFn(5,dayFn(10,monthFn(march,yearFn(1981)))))).

% Test F2: 30 days forward crossing one month
% Dec 25 + 30 = Jan 24
tff(test_fwd_one_month,conjecture,
  ?[D:$int,M:$i,Y:$int]:(
    dayFn(D,monthFn(M,yearFn(Y))) =
      addDayFn(30,dayFn(25,monthFn(december,yearFn(1980)))))).

% Test F3: 90 days forward crossing three months
% Dec 25 + 90 = Mar 25
%tff(test_fwd_three_months,conjecture,
%  ?[D:$int,M:$i,Y:$int]:(
%    dayFn(D,monthFn(M,yearFn(Y))) =
%      addDayFn(90,dayFn(25,monthFn(december,yearFn(1980)))))).

% BACKWARD TESTS

% Test B1: 5 days backward within same month
% March 15 - 5 = March 10
%tff(test_bwd_same_month,conjecture,
%  ?[D:$int,M:$i,Y:$int]:(
%    dayFn(D,monthFn(M,yearFn(Y))) =
%      addDayFn($uminus(5),dayFn(15,monthFn(march,yearFn(1981)))))).

% Test B2: 30 days backward crossing one month
% Jan 24 - 30 = Dec 25
%tff(test_bwd_one_month,conjecture,
%  ?[D:$int,M:$i,Y:$int]:(
%    dayFn(D,monthFn(M,yearFn(Y))) =
%      addDayFn($uminus(30),dayFn(24,monthFn(january,yearFn(1981)))))).

% Test B3: 90 days backward crossing three months
% Mar 25 - 91 = Dec 24, 1980
%tff(test_bwd_three_months,conjecture,
%  ?[D:$int,M:$i,Y:$int]:(
%    dayFn(D,monthFn(M,yearFn(Y))) =
%      addDayFn($uminus(91),dayFn(25,monthFn(march,yearFn(1981)))))).

% Test B4: Backward year crossing
% Jan 10 - 20 = Dec 21, 1980
%tff(test_bwd_year_cross,conjecture,
%  ?[D:$int,M:$i,Y:$int]:(
%    dayFn(D,monthFn(M,yearFn(Y))) =
%      addDayFn($uminus(20),dayFn(10,monthFn(january,yearFn(1981)))))).
